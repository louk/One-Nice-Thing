{% extends "submain.html" %}
{% block subcontent %}
    <div class="tree dragscroll">
        <ul class='active'>
            <li>
            <a data-show='1'><span><img src='img/placeholder.png'></span><span>{{ user.username }}</span></a>
            <ul>
                {% for tree in trees %}
                <li>
                <a onclick="tree('{{ tree.refered_user.objectId }}');" data-show='2'><span><img src='img/placeholder.png'>
                </span><span>{{ tree.refered_user.username }}</span></a>
                <ul id="{{ tree.refered_user.objectId }}">
                </ul>
                </li>
                {% endfor %}
            </ul>
            </li>
        </ul>
    </div>
    <div id='show'>
        <div class="ui card show1">
            <div class='content'>Everything the user has posted...</div>
            <div class='content'>Thank you</div>
        </div>
        <div class="ui card show2">
            <div class='content'><i class="user icon"></i>Svdsfjghsdfl</div>
            <div class='content'><i class="location arrow icon"></i>17 Tsagdaa Street, Ulaanbaatar, Mongolia</div>
            <div class='content'><i class="calendar icon"></i>February 2nd at 10:06am</div>
            <div class='content'>Everything the user has posted is handled and posted using jQuery; it is written to the chat log with PHP. The only thing left to do is to display the updated chat log to the user.</div>
            <div class='content'>Thank you</div>
        </div>
    </div>
{% endblock %}
{% block scripting %}
    <script src='js/dragscroll.js'></script>
    <script src='js/jquery-2.2.0.min.js'></script>
    <script>
    function tree(id){
        $.ajax({
            type: "POST",
            url: "index.php",
            data: {viewThings:id},
            success: function(data, textStatus, jqXHR)
            {
                var nicething = data;
                var content = "";
                for(var i=0; i<nicething.length; i++){
                    content +="<li><a onclick=tree('"+nicething[i].refered_user+"');><span><img src='img/placeholder.png'></span><span>"+
                    nicething[i].name+"</span></a><ul id='"+nicething[i].refered_user+"'></ul></li>";
                }
                $("#"+id).empty();
                $("#"+id).append(content);
            }
        });
    }
    $(function(){
        function treeWidth(){
        var window_w = $(window).width(),
        menu_w =  $('#submenu').width(),
        container_w = $('.container').width(),
        margin_left = parseInt($('.margin-left').css('margin-left'),10),
        tree_w = container_w - menu_w - margin_left;

        $('.tree').width(tree_w);
        }
        treeWidth();
        $(window).resize(function(){
                treeWidth();
                })

        $(document).on('click','.active>li>a',function(){
                $this = $(this).next('ul');
                if($this.hasClass('active')){
                $this.removeClass('active');
                $this.find('ul').removeClass('active');
                }else{
                $this.addClass('active')
                }
                });

        var offset_element = $('.tree>ul>li>a').offset(),
            offset_tree = $('.tree').offset(),
            tree_h = $('.tree').height(),
            element_h = $('.tree>ul>li>a').height(),
            tree_w = $('.tree').width(),
            element_w = $('.tree>ul>li>a').width();

        $('.tree .active>li>ul').addClass('active');

        $('.tree').scrollLeft(offset_element.left - offset_tree.left - (tree_w - element_w)/2);
        $('.tree').scrollTop(offset_element.top - offset_tree.top - (tree_h - element_h)/2);
    });
    </script>
{% endblock %}
